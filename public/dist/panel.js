function Camera(e){var o=this;this.video=e,this.stream=null,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({video:!0},function(e){o.stream=e,o.video.srcObject=e},function(){alert("ناتوان در فعال سازی دوربین")}),this.ss=function(e,s){if(null!=o.video){$(s).data("nopreview")||$(s).fadeIn("fast"),s.getContext("2d").drawImage(o.video,0,0,s.width,s.height);var t=s.toDataURL("image/jpeg");$(e).val(t)}else alert("لطفا ابتدا دوربین را روشن کنید")}}Vue.directive("focus",{inserted:function(e){e.focus()}}),Vue.directive("input-number",{inserted:function(e){var o="",s=$(e).data("minlen")?$(e).data("minlen"):0,t=$(e).data("maxlen")?$(e).data("maxlen"):10;if(t)for(var n=0;n<t;n++)o+=s>0&&n>=s?"p":"d";$(e).mask(o,{clearIfNotMatch:!0})}}),Vue.component("sidebar-timer",{props:[],data:function(){return{timer:""}},mounted:function(){var e=this;setInterval(function(){var o=new Date;e.timer=("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)},1e3)}}),Vue.component("camera-screenshot",{props:[],data:function(){return{showCanvas:""}},mounted:function(){var e=this;this.camera=new Camera(this.$refs.video),events.$on("takeScreenshot",function(){e.takeScreenshot()}),events.$on("clearScreenshot",function(){e.clear()})},methods:{takeScreenshot:function(){this.camera.ss(this.$refs.input,this.$refs.canvas),this.showCanvas=!0},clear:function(){this.$refs.input.value="",this.showCanvas=!1}}}),Vue.component("person-register",{props:[],data:function(){return{loading:!1,disable:!1,errors:{},result:{}}},methods:{submit:function(){var e=this;e.loading||e.disable||(e.errors={},e.disable=e.loading=!0,e.result={},$(e.$refs.autoss).prop("checked")&&e.$refs.camera.takeScreenshot(),$.ajax({type:"post",url:"",data:$(e.$refs.form).serialize(),dataType:"json",cache:!1,timeout:15e3,error:function(o){if($(".content-wrapper").css("background-color","red"),422!=o.status)return alert("ارتباط برقرار نشد");e.errors=o.responseJSON.errors},success:function(o){e.result=o,"success"==e.result.type?(e.$refs.code.value=e.$refs.name.value=e.$refs.father.value=e.$refs.melli.value="",$(".content-wrapper").css("background-color","green"),e.$refs.code.focus()):$(".content-wrapper").css("background-color","red")}}).always(function(){e.$refs.camera.clear(),e.loading=!1,setTimeout(function(){$(".content-wrapper").css("background-color","#ecf0f5"),e.disable=!1},1e3)}))}}}),Vue.component("person-search",{props:[],data:function(){return{loading:!1,disable:!1,code:"",error:""}},methods:{submit:function(){var e=this;e.loading||e.disable||$.ajax({type:"post",url:"",data:{code:e.code},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){e.error="",e.disable=e.loading=!0,$(e.$refs.result).hide()},error:function(e){return alert("ارتباط برقرار نشد")},success:function(o){if(e.code="",o.error)return e.error=o.error;$(e.$refs.result).html(o.personinfo).fadeIn("fast")}}).always(function(){e.loading=!1,setTimeout(function(){e.disable=!1,setTimeout(function(){$(e.$refs.code).focus()},100)},1e3)})}}}),Vue.component("page-taradod",{props:[],data:function(){return{loading:!1,disable:!1,type:"داخل",code:"",error:"",success:"",codeFocused:!1}},mounted:function(){var e=this;$(window).on("keydown",function(o){112==o.keyCode?(e.type="داخل",e.$refs.code.focus()):113==o.keyCode&&(e.type="خارج",e.$refs.code.focus())}),setInterval(function(){e.codeFocused||(e.$refs.code.focus(),e.codeFocused=!0)},500)},methods:{submit:function(){var e=this;e.loading||e.disable||$.ajax({type:"post",url:"",data:{code:e.code,type:e.type},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){e.success=e.error="",e.disable=e.loading=!0,$(e.$refs.result).hide()},error:function(e){return alert("ارتباط برقرار نشد")},success:function(o){e.code="",o.error&&(e.error=o.error,$(e.$refs.box).addClass("box-very-danger")),o.success&&(e.success=o.success,$(e.$refs.box).addClass("box-very-success")),o.personinfo&&$(e.$refs.result).html(o.personinfo).fadeIn("fast")}}).always(function(){e.loading=!1,setTimeout(function(){e.disable=!1,setTimeout(function(){$(e.$refs.code).focus()},100),$(e.$refs.box).removeClass("box-very-success box-very-danger")},1e3)})}}}),Vue.component("page-screenshot",{props:[],data:function(){return{loading:!1,disable:!1,type:"",code:"",error:"",success:""}},mounted:function(){var e=this;$(window).on("keydown",function(o){112==o.keyCode?(e.type="داخل",e.$refs.code.focus()):113==o.keyCode?(e.type="خارج",e.$refs.code.focus()):114==o.keyCode&&(e.type="",e.$refs.code.focus())})},methods:{submit:function(){var e=this;e.loading||e.disable||(e.$refs.camera.takeScreenshot(),$.ajax({type:"post",url:"",data:{type:e.type,code:e.code,image:$("#person_camera_data").val()},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){e.success=e.error="",e.disable=e.loading=!0,$(e.$refs.result).hide()},error:function(e){return alert("ارتباط برقرار نشد")},success:function(o){e.code="",o.error&&(e.error=o.error,$(e.$refs.box).addClass("box-very-danger")),o.success&&(e.success=o.success,$(e.$refs.box).addClass("box-very-success")),o.personinfo&&$(e.$refs.result).html(o.personinfo).fadeIn("fast")}}).always(function(){e.loading=!1,setTimeout(function(){e.disable=!1,setTimeout(function(){$(e.$refs.code).focus()},100),$(e.$refs.box).removeClass("box-very-success box-very-danger")},1e3)}))}}}),Vue.component("page-persontocode",{props:[],data:function(){return{loading:!1,disable:!1,type:"",code:"",father:"",error:"",success:"",persons:[]}},mounted:function(){var e=this;$(window).on("keydown",function(o){112==o.keyCode?e.type="داخل":113==o.keyCode?e.type="خارج":114==o.keyCode&&(e.type="")})},methods:{submit:function(){var e=this;e.loading||e.disable||$.ajax({type:"post",url:"",data:{father:e.father,code:e.code},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){e.success=e.error="",e.disable=e.loading=!0,$(e.$refs.result).hide()},error:function(e){return alert("ارتباط برقرار نشد")},success:function(o){e.code="",o.error&&(e.error=o.error,$(e.$refs.box).addClass("box-very-danger"),e.persons=[]),o.success&&(e.success=o.success,$(e.$refs.box).addClass("box-very-success")),o.persons&&(e.persons=o.persons)}}).always(function(){e.loading=!1,e.disable=!1,setTimeout(function(){$(e.$refs.code).focus()},100),setTimeout(function(){$(e.$refs.box).removeClass("box-very-success box-very-danger")},500)})}}}),Vue.component("page-persontocode-person",{props:["index","url","camera","type"],data:function(){return{loading:!1,code:""}},mounted:function(){},methods:{submit:function(e,o){var s=this;s.loading||($("#autoss").prop("checked")&&events.$emit("takeScreenshot"),$.ajax({type:"post",url:s.url,data:{id:e,code:o,taradod:s.type,image:$("#person_camera_data").val()},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){s.loading=!0,s.$parent.error=s.$parent.success=""},error:function(e){return alert("ارتباط برقرار نشد")},success:function(e){if(e.error&&(s.$parent.error=e.error),e.success){s.$parent.success=e.success,s.$parent.persons.splice(s.index,1);var o=$("#list-group").find("input");o[0]&&o[0].focus()}}}).always(function(){s.loading=!1,events.$emit("clearScreenshot")}))}}}),Vue.component("page-bankarevan",{props:["type"],data:function(){return{}},mounted:function(){},methods:{}}),Vue.component("quick-person-search",{props:["url"],data:function(){return{loading:!1,disable:!1,isOpen:!1,code:"",error:"",timeout:null,canIOpenIt:!1}},mounted:function(){$(window).on("keydown",this.openOnDoubleBtn),$(window).on("keyup",this.escBtn),$(this.$el).on("show.bs.modal",this.modalShow),$(this.$el).on("shown.bs.modal",this.modalShown),$(this.$el).on("hide.bs.modal",this.modalHide),$(this.$el).on("hidden.bs.modal",this.modalHidden)},methods:{openOnDoubleBtn:function(e){var o=this;if(192==e.keyCode&&!o.isOpen){if(o.canIOpenIt)return null!==o.timeout&&(o.timeout=null,clearTimeout(o.timeout)),o.canIOpenIt=!1,$(o.$el).modal("show");o.canIOpenIt=!0,o.timeout=setTimeout(function(){o.canIOpenIt=!1},800)}},escBtn:function(e){if(27==e.keyCode&&this.isOpen)return $(this.$el).modal("hide")},modalShow:function(){this.isOpen=!0},modalShown:function(){this.$refs.code.focus()},modalHide:function(){this.isOpen=!1},modalHidden:function(){},submit:function(){var e=this;e.loading||e.disable||$.ajax({type:"post",url:e.url,data:{code:e.code},dataType:"json",cache:!1,timeout:15e3,beforeSend:function(){e.error="",e.disable=e.loading=!0,$(e.$refs.result).hide()},error:function(e){return alert("ارتباط برقرار نشد")},success:function(o){if(e.code="",o.error)return e.error=o.error;$(e.$refs.result).html(o.personinfo).fadeIn("fast")}}).always(function(){e.loading=!1,setTimeout(function(){e.disable=!1,setTimeout(function(){$(e.$refs.code).focus()},100)},1e3)})}}});var events=new Vue,master=new Vue({el:"#master"});$(document).ready(function(){$("body").animate({scrollTop:$("body").scrollTop()+1})}),$.fn.dataTable.ext.errMode="none",window.addEventListener("keydown",function(e){e.altKey&&(37===e.keyCode?window.history.back():39===e.keyCode&&window.history.forward())});
